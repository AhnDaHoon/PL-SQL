-- 사원번호 ==> 자신의 급여와 부서 평균 급여중 더 큰 값을 리턴하는 함수
-- GET_EVL_SAL

CREATE OR REPLACE FUNCTION GET_EVL_SAL (VEMPNO EMP.EMPNO%TYPE)
	RETURN NUMBER
IS
	VAVGSAL NUMBER(10) := 0;
	VSAL NUMBER(10) := 0;
BEGIN
	SELECT AVG(SAL)
		INTO VAVGSAL
	FROM EMP
	WHERE DEPTNO =(SELECT DEPTNO FROM EMP WHERE EMPNO = VEMPNO);

	SELECT SAL
		INTO VSAL
	FROM EMP
	WHERE EMPNO = VEMPNO;

	IF VSAL >= VAVGSAL THEN 
		RETURN VSAL;
	ELSE
		RETURN VAVGSAL ;
	END IF;


-- 쿼리문으로만 작성
--	SELECT E.SAL, D.AVGSAL
--		INTO VSAL, VAVGSAL
--	FROM EMP E, (SELECT DEPTNO, AVG(SAL) AVGSAL FROM EMP GROUP BY DEPTNOP) D
--	WHERE E.DEPTNO = D.DEPTNO AND E.EMPNO = VEMPNO;

END;
/